"use strict";window.Redactor.add("plugin","medialibrary",{init:function(e){this.app=e,this.opts=e.opts,this.lang=e.lang,this.inline=e.inline,this.toolbar=e.toolbar,this.func=new this.funcInit(this)},start:function(){var e=this.toolbar.addButton("medialibrary",{title:"MediaLibrary",api:"plugin.medialibrary.addMedialibrary"});e.setIcon('<i class="material-icons">photo_library</i>'),this.buttonElement=e.nodes[0],this.$currentTag=!1,$(document).on("reload.qor.bottomsheets",".qor-bottomsheets__mediabox",this.func.initItem)},addMedialibrary:function(){this.$currentTag=this.app.selection.getCurrent(),this.func.addMedialibrary()},funcInit:function(e){var f=e,o=this;this.addMedialibrary=function(){var e,t={selectModal:"mediabox",maxItem:"1"},i=$(f.app.rootElement).data().redactorSettings.medialibraryUrl;o.BottomSheets=e=$("body").data("qor.bottomsheets"),t.url=i,e.open(t,function(e){o.handleMediaLibrary(e)})},this.handleMediaLibrary=function(e){var t={onSelect:o.handleResults,onSubmit:o.handleResults};(o.$bottomsheets=e).qorSelectCore(t).addClass("qor-bottomsheets__mediabox"),o.initItem()},this.initItem=function(){var e,t;$(".qor-bottomsheets").find("tbody tr").each(function(){e=$(this),t=e.find(".qor-table--ml-slideout p img").first(),e.find(".qor-table__actions").remove(),t.length&&(e.find(".qor-table--medialibrary-item").css("background-image","url("+t.prop("src")+")"),t.parent().remove())})},this.handleResults=function(e){var t=e.MediaOption;"video_link"==e.SelectedType||t.Video||t.URL.match(/\.mp4$|\.m4p$|\.m4v$|\.m4v$|\.mov$|\.mpeg$|\.webm$|\.avi$|\.ogg$|\.ogv$/)?o.insertVideo(e):o.insertImage(e),o.$bottomsheets.remove(),$(".qor-bottomsheets").is(":visible")||$("body").removeClass("qor-bottomsheets-open")},this.insertVideo=function(e){var t=$(f.app.editor.$editor.nodes[0]),i=$(f.app.rootElement);f.opts.mediaContainerClass=void 0===f.opts.mediaContainerClass?"qor-video-container":f.opts.mediaContainerClass;var o,a,r,n,d,s,l={},m=f.opts.mediaContainerClass,c=f.opts.regex.youtube,p=f.opts.regex.vimeo,u=/(\/id_)(\w+)/,h="qor-video-"+(Math.random()+1).toString(36).substring(7),b=e.MediaOption,g=b.Description;r='<figure class="'+m+'"><iframe title="'+g+'" width="100%" height="380px" src="',n='" frameborder="0" allowfullscreen></iframe><figcaption>'+g+"</figcaption></figure>","video_link"==e.SelectedType?((a=b.Video).match(c)&&(d="youtube",o=a.replace(c,r+"//www.youtube.com/embed/$1"+n)),a.match(p)&&(d="vimeo",o=a.replace(p,r+"//player.vimeo.com/video/$2"+n)),a.match(/http?:\/\/(www\.)|(v\.)youku.com/)&&u.test(a)&&(d="youku",o='<iframe width=100% height=400 src="http://player.youku.com/embed/'+a.match(u)[2]+'" frameborder=0 "allowfullscreen"></iframe>')):b.URL.match(/\.mp4$|\.m4p$|\.m4v$|\.m4v$|\.mov$|\.mpeg$|\.webm$|\.avi$|\.ogg$|\.ogv$/)&&(d="uploadedVideo",o='<figure class="'+m+'"><div role="application"><video width="100%" title="'+g+'" aria-label="'+g+'" height="380px" controls="controls" aria-describedby="'+h+'" tabindex="0"><source src="'+b.URL+'"></video></div><figcaption id="'+h+'">'+g+"</figcaption></figure>"),o&&(s=$(o).addClass(h),f.$currentTag?$(f.$currentTag).after(s):t.prepend(s),l.type=d,l.videoLink=a||b.URL,l.videoIdentification=h,l.description=g,l.$editor=t,(l.$element=i).trigger("insertedVideo.redactor",[l]))},this.insertImage=function(e){var t,i=$(f.app.editor.$editor.nodes[0]),o=$(f.app.rootElement),a=$("<img>"),r=$("<figure>"),n=e.MediaOption,d={};t=n.URL.replace(/image\..+\./,"image."),a.attr({src:t,alt:n.Description}),r.append(a),f.$currentTag?$(f.$currentTag).after(r):i.prepend(r),r.addClass("redactor-component"),r.attr({"data-redactor-type":"image",tabindex:"-1",contenteditable:!1}),d.description=n.Description,d.$img=r,d.$editor=i,(d.$element=o).trigger("insertedImage.redactor",[d])}}});